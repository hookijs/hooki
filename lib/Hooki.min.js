!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Hooki",[],e):"object"==typeof exports?exports.Hooki=e():t.Hooki=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,r){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.ActionTypes=e.HookTypes=void 0;var a=function(){function t(t,e){var r=[],n=!0,o=!1,a=void 0;try{for(var c,u=t[Symbol.iterator]();!(n=(c=u.next()).done)&&(r.push(c.value),!e||r.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{!n&&u.return&&u.return()}finally{if(o)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),u=r(1),i=e.HookTypes={class:Symbol("classHook"),object:Symbol("objectHook"),func:Symbol("functionHook")},s=e.ActionTypes={Func:Symbol("funcAction"),Get:Symbol("getAction"),Set:Symbol("setAction"),Getter:Symbol("getterAction"),Setter:Symbol("setterAction"),Construct:Symbol("constructAction")},l=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(o(this,t),!e)throw new Error("Hooki: target param is required");if((0,u.validateHooks)(r,n,a),this.hooks={before:(0,u.nameFunctions)(r),after:(0,u.nameFunctions)(n),error:(0,u.nameFunctions)(a)},this.current={},u.is.class(e))return this.Class=e,this.type=i.class,this.invokeClass();if(u.is.object(e))return this.target=e,this.type=i.object,this.invokeObject();throw new Error("Hooki: target must be object, function or class")}return c(t,[{key:"setCurrent",value:function(t,e,r){this.current={name:t,type:e,action:r}}},{key:"createContextData",value:function(t){var e=this;return function(r){var n=(0,u.createParams)(t,r),o=e.current.action,a=e.current.name,c=void 0;switch(o){case s.Func:c={name:a,action:o,params:n,stash:{args:r,params:n},self:e.target,get args(){return Object.values(this.params)}};break;case s.Set:c={name:a,action:o,value:n.value,stash:{value:n.value},self:e.target};break;case s.Setter:c={name:a,action:o,params:n,stash:{args:r,params:n},self:e.target,get args(){return Object.values(this.params)}};break;case s.Get:c={name:a,action:o,value:n.value,stash:{value:n.value},self:e.target};break;case s.Getter:c={name:a,action:o};break;case s.Construct:var i=(0,u.createParams)(e.Class,r);c={name:a,action:o,params:i,stash:{args:r,params:i},self:e.Class,get args(){return Object.values(this.params)}};break;default:throw new Error("Action "+o+" do not exists!")}return c}}},{key:"applyHook",value:function(t,e){if(t.error&&"error"!==t.type)return t;t.hookName=e.name;var r=void 0;try{r=e(t)}catch(e){var n=Object.assign(t,{error:e});return this.processHooks("error")(n)}var o=["args","stash","value","action","hookName","type","instance","error"];if(void 0===r||null===r)throw Error("'"+e.name+"' hook must return context data");return Object.assign(t,u.omit.apply(void 0,[r].concat(o)))}},{key:"processHooks",value:function(t){var e=this;return function(r){var n=Object.assign(r,{type:t}),o=e.current.name;return(e.hooks[t][o]||[]).reduce(e.applyHook.bind(e),n)}}},{key:"applyOriginalFunction",value:function(t){var e=this;return function(r){var n=void 0;e.current.action===s.Func&&(n=r.args),e.current.action===s.Construct&&(n=[r.args]),e.current.action!==s.Get&&e.current.action!==s.Set||(n=[r.value]);var o=t.apply(e.target,n);return void 0===o||null===o?r:e.current.action===s.Construct?Object.assign({},(0,u.omit)(r,"args"),{instance:e.target}):Object.assign({},(0,u.omit)(r,"args"),{result:o})}}},{key:"decorateFunction",value:function(t){var e=this;return function(){for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];var c=[n].map(e.createContextData(t)).map(e.processHooks("before")).map(e.applyOriginalFunction(t)).map(e.processHooks("after"));return a(c,1)[0].result}}},{key:"createTraps",value:function(){var t=this;return{get:function(e,r){function n(t){return t}var o=Reflect.getOwnPropertyDescriptor(e,r);if(void 0!==o&&null!==o){if(o.get){var a=function(t){return t()};return t.setCurrent(r,"get",s.Getter),t.decorateFunction(o.get)(a)}if("function"==typeof o.value){t.setCurrent(r,"get",s.Func);var c=e[r];return t.decorateFunction(c)}return t.setCurrent(r,"get",s.Get),t.decorateFunction(n)(e[r])}},set:function(e,r,n){function o(t){return e[r]=t,!0}t.setCurrent(r,"set");var a=Reflect.getOwnPropertyDescriptor(e,r);return a.set?(t.setCurrent(r,"set",s.Setter),t.decorateFunction(a.set)(n),!0):(t.setCurrent(r,"set",s.Set),t.decorateFunction(o)(n),!0)},construct:function(t,e,r){console.log(t,e,r)}}}},{key:"createProxy",value:function(t){return this.proxy=new Proxy(this.target,this.createTraps()),this.proxy}},{key:"invokeObject",value:function(){return this.createProxy(this.target)}},{key:"invokeClass",value:function(){var t=this;return new Proxy(this.Class,{construct:function(e,r,o){t.setCurrent("construct","get",s.Construct);var a=function(e){return t.target=new(Function.prototype.bind.apply(t.Class,[null].concat(n(e)))),e};return t.decorateFunction(a).apply(void 0,n(r)),t.createProxy(t.target)}})}}]),t}();e.default=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(t){return(t+"").replace(/[\/][\/].*$/gm,"").replace(/\s+/g,"").replace(/[\/][*][^\/*]*[*][\/]/g,"").split(/\)[\{=]/,1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},a=(e.createParams=function(t,e){return o(t).reduce(function(t,r,n){return t[r]=e[n],t},{})},e.omit=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return Object.keys(t).reduce(function(e,n){return r.find(function(t){return t===n})||(e[n]=t[n]),e},{})},e.nameFunctions=function(t){var e=function(t){return"object"!==(void 0===t?"undefined":n(t))||Array.isArray(t)?t:Object.keys(t).map(function(e){return t[e]})};return Object.keys(t).reduce(function(r,n){return r[n]=e(t[n]).map(function(t,e){return t&&!t.name&&Object.defineProperty(t,"name",{value:"hook-"+(e+1)}),t}),r},{})},Function.prototype.toString),c=function(t){return a.call(t).replace(/^[^{]*{\s*/,"").replace(/\s*}[^}]*$/,"")},u=function(t){return"function"==typeof t&&(/^class\s/.test(a.call(t))||/classCallCheck\(/.test(c(t)))},i=function(t){return"object"===(void 0===t?"undefined":n(t))&&!Array.isArray(t)&&null!==t},s=e.is={class:u,object:i};e.validateHooks=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];e.forEach(function(t){if(!s.object(t))throw new Error("Hooki: bundle hooks must be an object");var e=!0,r=!1,o=void 0;try{for(var a,c=Object.keys(t)[Symbol.iterator]();!(e=(a=c.next()).done);e=!0){var u=a.value,i=t[u];if(s.object(i))return!0;if(Array.isArray(i))return i.forEach(function(t){if("function"===!(void 0===t?"undefined":n(t)))throw new Error("Hooki: hook must be a function!")}),!0;throw new Error("Hooki: invalid schema for bundle hooks!")}}catch(t){r=!0,o=t}finally{try{!e&&c.return&&c.return()}finally{if(r)throw o}}return!0})}}])});